import os
import shutil
import pandas as pd
import streamlit as st
from PIL import Image

# Contrase√±a de protecci√≥n (puedes cambiarla por una m√°s segura)
PASSWORD = "miContrase√±aSegura"

# Funci√≥n para borrar archivo
def borrar_archivo(directorio, archivo_seleccionado):
    # Pedir al usuario que ingrese la contrase√±a
    contrasena = st.text_input("Ingrese la contrase√±a para borrar el archivo:", type="password")
    
    if contrasena == PASSWORD:
        # Borrar el archivo seleccionado
        try:
            os.remove(os.path.join(directorio, archivo_seleccionado))
            st.success(f"Archivo '{archivo_seleccionado}' borrado con √©xito.")
        except Exception as e:
            st.error(f"No se pudo borrar el archivo. Error: {e}")
    else:
        if contrasena:
            st.error("Contrase√±a incorrecta. Intente nuevamente.")

# Funci√≥n para listar archivos (Documentos)
def listar_archivos(carpeta_destino):
    ruta_carpeta = os.path.join(directorio_principal, carpeta_destino)
    
    if os.path.exists(ruta_carpeta):
        st.subheader(f"Archivos en {carpeta_destino}:")
        for root, dirs, files in os.walk(ruta_carpeta):
            nivel = root.replace(ruta_carpeta, '').count(os.sep)
            sangria = ' ' * 4 * (nivel)
            st.write(f'{sangria}{os.path.basename(root)}/')
            sub_sangria = ' ' * 4 * (nivel + 1)
            for f in files:
                ruta_completa = os.path.join(root, f)
                st.write(f'{sub_sangria}{f}')
                
                # Agregar bot√≥n para descarga
                with open(ruta_completa, "rb") as file:
                    btn = st.download_button(
                        label=f"Descargar {f}",
                        data=file,
                        file_name=f,
                        mime="application/octet-stream"
                    )
                
                # Agregar un √≠cono para borrar el archivo
                if st.button(f"üóëÔ∏è Borrar {f}", key=f"{root}-{f}"):
                    borrar_archivo(root, f)
    else:
        st.warning(f"No existen archivos en {carpeta_destino}.")

# Funci√≥n para mostrar el men√∫ principal
def menu_principal():
    # Opciones del men√∫ en la barra lateral
    opcion = st.sidebar.radio("Seleccione una secci√≥n:", ["Men√∫ Principal", "Normatividad", "Estad√≠sticas", "Documentos"])
    
    # Mostrar contenido seg√∫n la opci√≥n seleccionada
    if opcion == "Men√∫ Principal":
        mostrar_menu_principal()  # Mostrar la secci√≥n principal
    elif opcion == "Normatividad":
        mostrar_normatividad()  # Mostrar la secci√≥n de Normatividad
    elif opcion == "Estad√≠sticas":
        mostrar_estadisticas()  # Mostrar la secci√≥n de Estad√≠sticas
    elif opcion == "Documentos":
        mostrar_documentos()  # Mostrar la secci√≥n de Documentos

# Funci√≥n para mostrar la secci√≥n de Normatividad
def mostrar_normatividad():
    st.title("Normatividad")
    st.write("Aqu√≠ podr√°s ver los documentos relacionados con la normatividad.")
    # Agrega contenido espec√≠fico para la secci√≥n de normatividad
    subir_archivos('normatividad')
    listar_archivos('normatividad')

# Funci√≥n para mostrar la secci√≥n de Estad√≠sticas
def mostrar_estadisticas():
    st.title("Estad√≠sticas")
    st.write("Aqu√≠ podr√°s ver los documentos y gr√°ficos relacionados con estad√≠sticas.")
    # Agrega contenido espec√≠fico para la secci√≥n de estad√≠sticas
    subir_archivos('estadisticas')
    listar_archivos('estadisticas')

# Funci√≥n para mostrar la secci√≥n de Documentos
def mostrar_documentos():
    st.title("Documentos")
    st.write("Aqu√≠ podr√°s ver los documentos subidos y gestionados.")
    # Agrega contenido espec√≠fico para la secci√≥n de documentos
    subir_archivos('Documentos')
    listar_archivos('Documentos')

# Llamar la funci√≥n principal para ejecutar la app
if __name__ == "__main__":
    menu_principal()

